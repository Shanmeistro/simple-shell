---
- name: Install Python and pip (system level)
  become: true
  ansible.builtin.package:
    name:
      - python3
      - python3-pip
      - python3-venv
    state: present
  register: devtools_python_system_install_result

- name: Verify pip3 is available
  ansible.builtin.command: which pip3
  register: devtools_pip3_check
  failed_when: false
  changed_when: false

- name: Install uv using pip3
  become: true
  ansible.builtin.command: pip3 install uv
  register: devtools_uv_install_result
  when: devtools_pip3_check is succeeded
  changed_when: "'Successfully installed' in devtools_uv_install_result.stdout"
  failed_when: devtools_uv_install_result.rc != 0

- name: Install ruff via uv
  become: true
  ansible.builtin.command: uv tool install ruff
  register: devtools_ruff_install_result
  when: devtools_uv_install_result is succeeded
  changed_when: "'Successfully installed' in devtools_ruff_install_result.stdout"
  failed_when: devtools_ruff_install_result.rc != 0
